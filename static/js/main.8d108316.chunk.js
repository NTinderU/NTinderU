(this["webpackJsonpntinderu-frontend"]=this["webpackJsonpntinderu-frontend"]||[]).push([[0],{197:function(t,e,n){},203:function(t,e){},205:function(t,e){},215:function(t,e){},217:function(t,e){},242:function(t,e){},243:function(t,e){},248:function(t,e){},250:function(t,e){},257:function(t,e){},276:function(t,e){},293:function(t,e,n){},297:function(t,e,n){},299:function(t,e,n){},300:function(t,e,n){},301:function(t,e,n){},302:function(t,e,n){},304:function(t,e,n){},305:function(t,e,n){"use strict";n.r(e);var r=n(3),s=n(0),a=n(40),c=n.n(a),o=n(11),i=n(2),u=n(176),l=n(15),j=(n(197),n.p+"static/media/NTU.30d99a60.png"),d=n(309),b=n(310),m=n(311),O=n(106),f=n(20);function h(){var t=Object(f.a)(["\n\tmutation($username: String!, $password: String!) {\n\t\tcreateUser(data: { username: $username, password: $password }) {\n\t\t\tusername\n\t\t\tpassword\n\t\t}\n\t}\n"]);return h=function(){return t},t}var g=Object(o.gql)(h()),p=Object(s.createContext)({loggedIn:!1,setLoggedIn:function(){},loggedInUser:!1,setLoggedInUser:function(){}});function x(){var t=Object(f.a)(["\n\tquery($username: String!) {\n\t\tuser(username: $username) {\n\t\t\tusername\n\t\t\tpassword\n\t\t}\n\t}\n"]);return x=function(){return t},t}var v=Object(o.gql)(x()),C=(n(293),[null,"Cannot be blank.","User not found.","Username has been used."]),w=[null,"Cannot be blank.","Incorrect password."],y=[null,"Cannot be blank.","Inconsistant with password."],N=function(t){var e=Object(s.useContext)(p),n=e.setLoggedIn,a=e.setLoggedInUser,c=Object(s.useState)(""),i=Object(l.a)(c,2),u=i[0],j=i[1],f=Object(s.useState)(""),h=Object(l.a)(f,2),x=h[0],N=h[1],S=Object(s.useState)(""),k=Object(l.a)(S,2),$=k[0],I=k[1],E=Object(s.useState)(""),U=Object(l.a)(E,2),L=U[0],M=U[1],T=Object(s.useState)(""),q=Object(l.a)(T,2),D=q[0],P=q[1],G=Object(o.useLazyQuery)(v,{variables:{username:L}}),_=Object(l.a)(G,2),H=_[0],R=_[1],B=R.loading,Q=R.data,z=Object(o.useMutation)(g),A=Object(l.a)(z,1)[0],F=function(){t.setUsernameError(0),t.setPasswordError(0),t.setConfirmError(0)},K=function(){N(""),I("")},J=function(){M(""),P("")},X=Object(s.useRef)(!1),Y=function(){(function(){F();var e=!1;return""===u?(t.setUsernameError(1),e=!0):t.setUsernameError(0),""===x?(t.setPasswordError(1),K(),e=!0):t.setPasswordError(0),t.signin||""!==$&&x===$?t.setConfirmError(0):(""===$?t.setConfirmError(1):t.setConfirmError(2),K(),e=!0),!e})()&&(J(),M(u),P(x),X.current=!0)};Object(s.useEffect)((function(){L&&H()}),[L,H]),Object(s.useEffect)((function(){if(L&&D&&Q)if(t.signin)null===Q.user?(t.setUsernameError(2),K(),J()):X.current&&(Object(O.compareSync)(D,Q.user.password)?(n(!0),a(L)):(t.setPasswordError(2),K(),J())),X.current=!1;else{if(null!==Q.user)t.setUsernameError(3),K(),J();else if(X.current){var e=Object(O.hashSync)(D,10);setTimeout((function(){n(!0),a(L)}),2500),A({variables:{username:L,password:e}})}X.current=!1}}),[B,Q,L,D,x,t,A,n,a]);var Z=function(t){return"Enter"===t.key?Y():void 0};return Object(r.jsxs)(d.a,{show:t.show,onHide:t.onHide,className:"popup-modal",centered:!0,children:[Object(r.jsx)(d.a.Header,{children:Object(r.jsx)(d.a.Title,{children:t.signin?"Sign In":"Sign Up"})}),Object(r.jsx)(d.a.Body,{children:Object(r.jsxs)(b.a,{className:"popup",children:[Object(r.jsxs)(b.a.Group,{controlId:"username",children:[Object(r.jsx)(b.a.Label,{children:"Username"}),Object(r.jsx)(b.a.Control,{disabled:B,type:"text",placeholder:"Username",onKeyUp:Z,onChange:function(t){return j(t.target.value)},value:u}),Object(r.jsx)(b.a.Text,{className:"error",children:C[t.usernameError]})]}),Object(r.jsxs)(b.a.Group,{controlId:"password",children:[Object(r.jsx)(b.a.Label,{children:"Password"}),Object(r.jsx)(b.a.Control,{disabled:B,type:"password",placeholder:"Password",onKeyUp:Z,onChange:function(t){return N(t.target.value)},value:x}),Object(r.jsx)(b.a.Text,{className:"error",children:w[t.passwordError]})]}),t.signin?Object(r.jsxs)(b.a.Text,{children:["Don't have an account?"," ",Object(r.jsx)("button",{onClick:function(){F(),J(),I(""),t.setsignin(0)},type:"button",children:"Sign Up"})]}):null,t.signin?null:Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)(b.a.Group,{controlId:"password-again",children:[Object(r.jsx)(b.a.Label,{children:"Confirm Password"}),Object(r.jsx)(b.a.Control,{disabled:B,type:"password",placeholder:"Confirm Password",onKeyUp:Z,onChange:function(t){return I(t.target.value)},value:$}),Object(r.jsx)(b.a.Text,{className:"error",children:y[t.confirmError]})]}),Object(r.jsxs)(b.a.Text,{children:["Have an account?"," ",Object(r.jsx)("button",{onClick:function(){F(),J(),t.setsignin(1)},type:"button",children:"Log in now"})]})]})]})}),Object(r.jsxs)(d.a.Footer,{children:[Object(r.jsx)(m.a,{variant:"secondary",onClick:t.onHide,children:"Cancel"}),Object(r.jsx)(m.a,{onClick:Y,children:t.signin?"Sign In":"Sign Up"})]})]})},S=function(){var t=Object(s.useState)(!1),e=Object(l.a)(t,2),n=e[0],a=e[1],c=Object(s.useState)(0),o=Object(l.a)(c,2),i=o[0],u=o[1],d=Object(s.useState)(0),b=Object(l.a)(d,2),m=b[0],O=b[1],f=Object(s.useState)(0),h=Object(l.a)(f,2),g=h[0],p=h[1],x=Object(s.useState)(0),v=Object(l.a)(x,2),C=v[0],w=v[1];return Object(r.jsxs)("div",{className:"index",children:[Object(r.jsxs)("div",{className:"index-header",children:[Object(r.jsx)("img",{className:"logo",alt:"NTU-logo",src:j}),Object(r.jsx)("button",{size:"lg",onClick:function(){u(0),O(0),a(!0),w(1)},children:"Sign In"})]}),Object(r.jsxs)("div",{className:"index-wrapper",children:[Object(r.jsx)("div",{id:"app-title",children:"NTinderU"}),Object(r.jsx)("button",{size:"lg",onClick:function(){u(0),O(0),p(0),a(!0),w(0)},children:"Sign Up"})]}),Object(r.jsx)(N,{signin:C,setsignin:w,show:n,onHide:function(){return a(!1)},usernameError:i,passwordError:m,confirmError:g,setUsernameError:u,setPasswordError:O,setConfirmError:p})]})},k=n(76),$=(n(297),function(t){return Object(r.jsxs)("button",{className:"chatroom-button".concat(t.choosing?" choosing":""),onClick:function(){t.sRID(t.roomID),t.sTN(t.username),t.sC(t.idx)},children:[Object(r.jsx)("img",{className:"chatroom-button-picture",src:"https://icon-library.com/images/default-user-icon/default-user-icon-13.jpg",alt:"user big"}),Object(r.jsxs)("div",{className:"chatroom-information",children:[Object(r.jsx)("div",{className:"chatroom-button-username",children:t.username}),Object(r.jsx)("div",{className:"chatroom-button-lastmessage",children:t.lastMessage})]})]})}),I=function(t){var e=t.rooms,n=t.setRoomID,a=t.setTargetName,c=Object(s.useState)(0),o=Object(l.a)(c,2),i=o[0],u=o[1];return Object(r.jsx)("div",{children:e.map((function(t,e){return Object(r.jsx)($,{choosing:e===i,idx:e,username:t.target,roomID:t.roomID,sRID:n,sTN:a,sC:u},e)}))})},E=n(60),U=n.n(E),L=n(107),M=(n(299),function(){return Object(r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",className:"bi bi-heart-fill",viewBox:"0 0 16 16",children:[Object(r.jsx)("defs",{children:Object(r.jsxs)("linearGradient",{id:"heartGradient",x1:"100%",y1:"0%",x2:"0%",y2:"100%",spreadMethod:"pad",children:[Object(r.jsx)("stop",{offset:"0%",stopColor:"#02df8a"}),Object(r.jsx)("stop",{offset:"100%",stopColor:"#66f0e1"})]})}),Object(r.jsx)("path",{fill:"url(#heartGradient)",fillRule:"evenodd",d:"M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"})]})}),T=function(){return Object(r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",className:"bi bi-x",viewBox:"0 0 16 16",children:[Object(r.jsx)("defs",{children:Object(r.jsxs)("linearGradient",{id:"xGradient",x1:"100%",y1:"0%",x2:"0%",y2:"100%",spreadMethod:"pad",children:[Object(r.jsx)("stop",{offset:"0%",stopColor:"#fd267d"}),Object(r.jsx)("stop",{offset:"100%",stopColor:"#ff7955"})]})}),Object(r.jsx)("path",{fill:"url(#xGradient)",d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})]})},q=function(t){var e=t.type,n=t.onClick;return Object(r.jsx)("button",{className:"mood-button".concat(e?" mood-".concat(e):""),onClick:n,children:"heart"===e?Object(r.jsx)(M,{}):"x"===e?Object(r.jsx)(T,{}):null})};function D(){var t=Object(f.a)(["\n\tquery($username: String!, $max_count: Int!) {\n\t\tmatch(data: { username: $username, max_count: $max_count }) {\n\t\t\tusername\n\t\t\tliked\n\t\t\tphoto\n\t\t}\n\t}\n"]);return D=function(){return t},t}var P=Object(o.gql)(D());function G(){var t=Object(f.a)(["\n\tmutation($username: String!, $target: String!) {\n\t\taddLikedUser(data: { username: $username, target: $target }) {\n\t\t\tusername\n\t\t\tliked\n\t\t}\n\t}\n"]);return G=function(){return t},t}var _=Object(o.gql)(G());function H(){var t=Object(f.a)(["\n\tmutation($username: String!, $target: String!) {\n\t\taddMatchedUser(data: { username: $username, target: $target }) {\n\t\t\tusername\n\t\t\tliked\n\t\t}\n\t\tcreateChatroom(data: { users: [$username, $target] }) {\n\t\t\tid\n\t\t}\n\t}\n"]);return H=function(){return t},t}var R=Object(o.gql)(H()),B=(n(300),function(t){var e=t.matchCount,n=Object(s.useContext)(p).loggedInUser,a=Object(s.useState)(0),c=Object(l.a)(a,2),i=c[0],u=c[1],j=Object(s.useState)(!1),d=Object(l.a)(j,2),b=d[0],m=d[1],O=Object(o.useQuery)(P,{variables:{username:n,max_count:e}}),f=O.loading,h=O.error,g=O.data,x=O.refetch,v=Object(o.useMutation)(_),C=Object(l.a)(v,1)[0],w=Object(o.useMutation)(R),y=Object(l.a)(w,1)[0],N=function(){var t=Object(L.a)(U.a.mark((function t(){return U.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i!==g.match.length-1){t.next=8;break}return m(!0),t.next=4,x();case 4:u(0),m(!1),t.next=9;break;case 8:u(i+1);case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),S=function(){return null===g||0===g.match.length||b?{username:"No People. Press Any Button to refetch",liked:[],photo:"https://via.placeholder.com/320x500.png"}:{username:g.match[i].username,liked:g.match[i].liked,photo:g.match[i].photo}},k=function(){var t=S(),e=t.username;"No People. Press Any Button to refetch"!==e&&(C({variables:{username:n,target:e}}),t.liked.includes(n)&&y({variables:{username:n,target:e}}))};return f?Object(r.jsx)("span",{children:"Loading..."}):h?Object(r.jsx)(r.Fragment,{}):Object(r.jsxs)("div",{className:"match-panel",children:[Object(r.jsx)("span",{children:S().username}),Object(r.jsx)("img",{className:"user-picture-big",src:S().photo,alt:"\u5e25\u54e5 || \u7f8e\u5973"}),Object(r.jsxs)("div",{className:"mood-buttons",children:[Object(r.jsx)(q,{type:"x",onClick:N}),Object(r.jsx)(q,{type:"heart",onClick:Object(L.a)(U.a.mark((function t(){return U.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,k();case 2:N();case 3:case"end":return t.stop()}}),t)})))})]})]})});function Q(){var t=Object(f.a)(["\n\tmutation($id: ID!, $from: String!, $to: String!, $body: String!) {\n\t\tcreateMessage(id: $id, data: { from: $from, to: $to, body: $body }) {\n\t\t\tfrom\n\t\t\tbody\n\t\t\ttimestamp\n\t\t}\n\t}\n"]);return Q=function(){return t},t}var z=Object(o.gql)(Q());function A(){var t=Object(f.a)(["\n\tquery($id: ID!, $target: String!) {\n\t\tchatroom(id: $id) {\n\t\t\tid\n\t\t\tusers\n\t\t\tmessages {\n\t\t\t\tfrom\n\t\t\t\tbody\n\t\t\t\ttimestamp\n\t\t\t}\n\t\t}\n\t\tuser(username: $target) {\n\t\t\tphoto\n\t\t}\n\t}\n"]);return A=function(){return t},t}var F=Object(o.gql)(A());function K(){var t=Object(f.a)(["\n\tsubscription($username: String!) {\n\t\tmessage(username: $username) {\n\t\t\tdata {\n\t\t\t\tfrom\n\t\t\t\tto\n\t\t\t\tbody\n\t\t\t\ttimestamp\n\t\t\t}\n\t\t}\n\t}\n"]);return K=function(){return t},t}var J=Object(o.gql)(K()),X=function(){return Object(r.jsx)("svg",{viewBox:"0 0 24 24",children:Object(r.jsx)("path",{d:"M16.6915026,12.4744748 L3.50612381,13.2599618 C3.19218622,13.2599618 3.03521743,13.4170592 3.03521743,13.5741566 L1.15159189,20.0151496 C0.8376543,20.8006365 0.99,21.89 1.77946707,22.52 C2.41,22.99 3.50612381,23.1 4.13399899,22.8429026 L21.714504,14.0454487 C22.6563168,13.5741566 23.1272231,12.6315722 22.9702544,11.6889879 C22.8132856,11.0605983 22.3423792,10.4322088 21.714504,10.118014 L4.13399899,1.16346272 C3.34915502,0.9 2.40734225,1.00636533 1.77946707,1.4776575 C0.994623095,2.10604706 0.8376543,3.0486314 1.15159189,3.99121575 L3.03521743,10.4322088 C3.03521743,10.5893061 3.34915502,10.7464035 3.50612381,10.7464035 L16.6915026,11.5318905 C16.6915026,11.5318905 17.1624089,11.5318905 17.1624089,12.0031827 C17.1624089,12.4744748 16.6915026,12.4744748 16.6915026,12.4744748 Z",fillRule:"evenodd",fill:"#0099ff",stroke:"none"})})},Y=(n(301),function(t){var e=t.target_username,n=t.current_roomid,a=Object(s.useContext)(p).loggedInUser,c=Object(o.useQuery)(F,{variables:{id:n,target:e}}),i=c.loading,u=c.error,j=c.data,d=c.subscribeToMore,b=c.refetch,m=Object(s.useState)(""),O=Object(l.a)(m,2),f=O[0],h=O[1],g=Object(s.useRef)(null),x=Object(o.useMutation)(z),v=Object(l.a)(x,1)[0];Object(s.useEffect)((function(){return g.current?g.current.scrollTop=g.current.scrollHeight:void 0}),[j,g]),Object(s.useEffect)((function(){b({variables:{id:n,target:e}})}),[n,b,e]);var C=function(){f.trim().length&&(v({variables:{id:n,from:a,to:e,body:f.trim()}}),h(""))};return Object(s.useEffect)((function(){d({document:J,variables:{username:a},updateQuery:function(t,r){var s=r.subscriptionData,c=t.chatroom.messages;if(!s.data)return t;var o=s.data.message.data;return o.from!==e&&o.from!==a?t:{prev:t,chatroom:{id:n,users:[a,e],messages:[].concat(Object(k.a)(c),[o])}}}})}),[n,a,d,e]),i?Object(r.jsx)("div",{children:"Loading..."}):u?Object(r.jsx)(r.Fragment,{}):Object(r.jsxs)("div",{className:"chat-panel",children:[Object(r.jsxs)("div",{className:"chat-header",children:[Object(r.jsx)("img",{className:"profile-picture",src:j?j.user.photo:"https://icon-library.com/images/default-user-icon/default-user-icon-13.jpg",alt:"profile"}),Object(r.jsx)("div",{children:e})]}),Object(r.jsx)("div",{className:"chat-messages",ref:g,children:i?Object(r.jsx)("p",{children:"Loading..."}):u?Object(r.jsx)("p",{children:"Error"}):j.chatroom.messages.map((function(t,e){var n=t.from,s=t.body;return Object(r.jsx)("div",{className:"chat-message".concat(n===a?" self":""),children:Object(r.jsx)("span",{children:s})},e)}))}),Object(r.jsxs)("div",{className:"chat-input",children:[Object(r.jsx)("div",{className:"chat-input-buttons"}),Object(r.jsx)("div",{className:"chat-input-wrapper",children:Object(r.jsx)("input",{type:"text",placeholder:"Aa",onChange:function(t){return h(t.target.value)},onKeyUp:function(t){return"Enter"===t.key?C():void 0},value:f})}),Object(r.jsx)("div",{className:"chat-input-submit",children:Object(r.jsx)("button",{className:"chat-input-submit-button",onClick:C,children:Object(r.jsx)(X,{})})})]})]})});function Z(){var t=Object(f.a)(["\n\tquery($username: String!) {\n\t\tuser(username: $username) {\n\t\t\tphoto\n\t\t}\n\t\tgetrooms(username: $username) {\n\t\t\ttarget\n\t\t\troomID\n\t\t}\n\t}\n"]);return Z=function(){return t},t}var V=Object(o.gql)(Z());function W(){var t=Object(f.a)(["\n\tsubscription($username: String!) {\n\t\tmatch(username: $username) {\n\t\t\tdata {\n\t\t\t\ttarget\n\t\t\t\troomID\n\t\t\t}\n\t\t}\n\t}\n"]);return W=function(){return t},t}var tt=Object(o.gql)(W()),et=(n(302),function(){var t=Object(s.useContext)(p).loggedInUser,e=Object(s.useState)("Matches"),n=Object(l.a)(e,2),a=n[0],c=n[1],i=Object(s.useState)("none"),u=Object(l.a)(i,2),j=u[0],d=u[1],b=Object(s.useState)("none"),m=Object(l.a)(b,2),O=m[0],f=m[1],h=Object(o.useQuery)(V,{variables:{username:t}}),g=h.loading,x=h.error,v=h.data,C=h.subscribeToMore;return Object(s.useEffect)((function(){C({document:tt,variables:{username:t},updateQuery:function(t,e){var n=e.subscriptionData;return{prev:t,getrooms:[].concat(Object(k.a)(t.getrooms),[n.data.match.data]),user:t.user}}})}),[t,C]),g||x?Object(r.jsx)(r.Fragment,{}):Object(r.jsxs)("div",{className:"main",children:[Object(r.jsxs)("div",{className:"left-panel",children:[Object(r.jsxs)("div",{className:"profile-wrapper",children:[Object(r.jsx)("img",{className:"profile-picture",src:v.user?v.user.photo:"https://icon-library.com/images/default-user-icon/default-user-icon-13.jpg",alt:"X"}),Object(r.jsx)("div",{className:"profile-title",children:"My Profile"})]}),Object(r.jsxs)("div",{className:"mode-buttons",children:[Object(r.jsx)("button",{className:"".concat("Matches"===a?"mode-choosing":""),onClick:function(){return c("Matches")},children:"Matches"}),Object(r.jsx)("button",{className:"".concat("Messages"===a?"mode-choosing":""),onClick:function(){var t=v.getrooms;t.length>0&&(d(t[0].roomID),f(t[0].target)),c("Messages")},children:"Messages"})]}),Object(r.jsx)("div",{className:"messages",children:"Messages"===a?Object(r.jsx)(I,{rooms:v.getrooms,setRoomID:d,setTargetName:f}):null})]}),"Matches"===a?Object(r.jsx)(B,{matchCount:30}):"none"!==j?Object(r.jsx)(Y,{current_roomid:j,target_username:O,current_username:t}):Object(r.jsx)("div",{children:"You don't have any chatroom"})]})}),nt=function(){var t=Object(s.useState)(!1),e=Object(l.a)(t,2),n=e[0],a=e[1],c=Object(s.useState)(""),o=Object(l.a)(c,2),i=o[0],u=o[1];return Object(r.jsx)(p.Provider,{value:{setLoggedIn:a,loggedInUser:i,setLoggedInUser:u},children:n?Object(r.jsx)(et,{}):Object(r.jsx)(S,{})})},rt=(n(303),n(304),"ntinderu-backend.herokuapp.com"),st=new o.HttpLink({uri:"https://".concat(rt,"/")}),at=new u.a({uri:"ws://".concat(rt,"/graphql"),options:{reconnect:!0}}),ct=Object(o.split)((function(t){var e=t.query,n=Object(i.p)(e);return"OperationDefinition"===n.kind&&"subscription"===n.operation}),at,st),ot=new o.ApolloClient({link:ct,cache:(new o.InMemoryCache).restore()});c.a.render(Object(r.jsx)(o.ApolloProvider,{client:ot,children:Object(r.jsx)(nt,{})}),document.getElementById("root"))}},[[305,1,2]]]);
//# sourceMappingURL=main.8d108316.chunk.js.map